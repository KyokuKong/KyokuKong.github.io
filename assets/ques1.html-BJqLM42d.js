import{_ as n}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o as s,c as a,e as t}from"./app-VDmVf4cw.js";const e={},p=t(`<details class="hint-container details"><summary>完整原题</summary><p>使用Solidity语言完成智能合约开发、部署和调用，要求如下： 1.食品信息（FoodInfoItem）的接口编码 （1）编写食品信息实体的接口，完成可溯源食品信息初始化，实现可追溯的原始生产商食品信息上链功能； 表2-2-1 FoodInfoItem实体说明</p><table><thead><tr><th>名称</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>_currentTraceName</td><td>string</td><td>当前用户名</td></tr><tr><td>_name</td><td>string</td><td>食品名称</td></tr><tr><td>_owner</td><td>address</td><td>合约的创建者</td></tr><tr><td>_quality</td><td>uint8</td><td>质量</td></tr><tr><td>_status</td><td>uint8</td><td>状态</td></tr><tr><td>_traceName</td><td>string[]</td><td>用户名</td></tr><tr><td>_timestamp</td><td>uint[]</td><td>流转时间戳</td></tr><tr><td>_traceAddress</td><td>address[]</td><td>用户地址</td></tr><tr><td>_traceQuality</td><td>uint8[]</td><td>食品质量</td></tr></tbody></table><div class="language-solidity line-numbers-mode" data-ext="solidity"><pre class="language-solidity"><code><span class="token keyword">contract</span> <span class="token class-name">FoodInfoItem</span><span class="token punctuation">{</span>
    <span class="token comment">//①保存食品流转过程中各个阶段的时间戳</span>
    <span class="token comment">//②保存食品流转过程各个阶段的用户名</span>
    <span class="token comment">//③保存食品流转过程各个阶段的用户地址信息（和用户一一对应）</span>
    <span class="token comment">//④保存食品流转过程中各个阶段的质量</span>
    <span class="token comment">//⑤食品名称</span>
    <span class="token comment">//⑥当前用户名称</span>
    <span class="token comment">//⑦质量（0=优质 1=合格 2=不合格）</span>
    <span class="token comment">//⑧状态（0:生产 1:分销 2:出售）</span>
    <span class="token comment">//⑨初始化owner</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（2）编写分销商食品上链信息接口，根据食品溯源智能合约地址获取分销商上链食品的信息；</p><div class="language-solidity line-numbers-mode" data-ext="solidity"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">addTraceInfoByDistributor</span><span class="token punctuation">(</span>①<span class="token punctuation">,</span> <span class="token builtin">uint8</span> quality<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>_status <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">,</span> <span class="token string">&quot;status must be producing&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//②</span>
        _timestamp<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">;</span>
        _traceName<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>traceName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        _currentTraceName <span class="token operator">=</span> traceName<span class="token punctuation">;</span>
        <span class="token comment">//③</span>
        <span class="token comment">//④</span>
        _traceQuality<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>_quality<span class="token punctuation">)</span><span class="token punctuation">;</span>
        _status <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（3）编写超市进行食品上链信息的接口，根据食品溯源智能合约地址获取超市上链食品信息。</p><div class="language-solidity line-numbers-mode" data-ext="solidity"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">addTraceInfoByRetailer</span><span class="token punctuation">(</span>①<span class="token punctuation">,</span> <span class="token builtin">uint8</span> quality<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>_status <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">,</span> <span class="token string">&quot;status must be distributing&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//②</span>
        _timestamp<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">;</span>
        _traceName<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>traceName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        _currentTraceName <span class="token operator">=</span> traceName<span class="token punctuation">;</span>
        <span class="token comment">//③</span>
        <span class="token comment">//④</span>
        _traceQuality<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>_quality<span class="token punctuation">)</span><span class="token punctuation">;</span>
        _status <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2.食品溯源(Trace)的接口编码 （1）编写食品溯源智能合约生产商Producer添加食品接口，必须生产商才能添加可溯源的食品，实现溯源功能；</p><div class="language-solidity line-numbers-mode" data-ext="solidity"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">newFood</span><span class="token punctuation">(</span>①<span class="token punctuation">,</span> <span class="token builtin">string</span> traceName<span class="token punctuation">,</span> <span class="token builtin">uint8</span> quality<span class="token punctuation">)</span>
	<span class="token keyword">public</span> ② <span class="token keyword">returns</span><span class="token punctuation">(</span>③<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">//④</span>
            <span class="token comment">//⑤</span>
            <span class="token comment">//⑥</span>
            <span class="token comment">//⑦</span>
            <span class="token comment">//⑧</span>
        <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（2）编写食品溯源智能合约分销商Distributor添加食品接口，必须分销商才能添加可溯源的食品，实现溯源功能；</p><div class="language-solidity line-numbers-mode" data-ext="solidity"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">addTraceInfoByDistributor</span><span class="token punctuation">(</span>①<span class="token punctuation">,</span> <span class="token builtin">uint8</span> quality<span class="token punctuation">)</span>
	<span class="token keyword">public</span> ② <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//③</span>
            <span class="token keyword">return</span> <span class="token function">FoodInfoItem</span><span class="token punctuation">(</span>foods<span class="token punctuation">[</span>traceNumber<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>④<span class="token punctuation">,</span> quality<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（3）编写食品溯源智能合约超市Retailer添加食品接口，必须超市才能添加可溯源的食品，实现溯源功能。</p><div class="language-solidity line-numbers-mode" data-ext="solidity"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">addTraceInfoByRetailer</span><span class="token punctuation">(</span>①<span class="token punctuation">,</span> <span class="token builtin">uint8</span> quality<span class="token punctuation">)</span>
	<span class="token keyword">public</span> ② <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">require</span><span class="token punctuation">(</span>③<span class="token punctuation">,</span> <span class="token string">&quot;traceNumber does not exist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token function">FoodInfoItem</span><span class="token punctuation">(</span>foods<span class="token punctuation">[</span>traceNumber<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>④<span class="token punctuation">,</span> quality<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3.角色（Role）管理的接口编码 （1）编写食品溯源增加角色接口，必须是未增加的角色才能被添加，实现添加角色的功能；</p><div class="language-solidity line-numbers-mode" data-ext="solidity"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span>①<span class="token punctuation">,</span> <span class="token builtin">address</span> account<span class="token punctuation">)</span> ② <span class="token punctuation">{</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token operator">!</span>③<span class="token punctuation">,</span> <span class="token string">&quot;Roles: account already has role&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        role<span class="token punctuation">.</span>④ <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（2）编写食品溯源移除角色接口，必须是已增加的角色才能被移除，实现移除角色的功能；</p><div class="language-solidity line-numbers-mode" data-ext="solidity"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">remove</span><span class="token punctuation">(</span>①<span class="token punctuation">,</span> <span class="token builtin">address</span> account<span class="token punctuation">)</span> ② <span class="token punctuation">{</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>③<span class="token punctuation">,</span> <span class="token string">&quot;Roles: account does not have role&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        role<span class="token punctuation">.</span>④ <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（3）编写食品溯源角色授权接口，必须是授权的角色地址，实现角色权限管理功能。</p><div class="language-solidity line-numbers-mode" data-ext="solidity"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">has</span><span class="token punctuation">(</span>①<span class="token punctuation">,</span> <span class="token builtin">address</span> account<span class="token punctuation">)</span> ② <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>③<span class="token punctuation">,</span> <span class="token string">&quot;Roles: account is the zero address&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> role<span class="token punctuation">.</span>④<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>4.合约编译、部署和调用 （1）解决代码错误和警告，正确编译并部署合约，成功获取部署的合约地址和abi； （2）调用食品溯源智能合约的接口，完整验证业务流程。</p></details><p>哎，做题是真的烦，想回去睡觉。感觉一天睡25个小时都还是困，比完了我要睡一星期🛌。 挨个做吧。</p><p><s>后记：虽然还没比，但是睡爽了，精力回归！</s></p><h2 id="_1-食品信息-foodinfoitem-的接口编码" tabindex="-1"><a class="header-anchor" href="#_1-食品信息-foodinfoitem-的接口编码" aria-hidden="true">#</a> 1.食品信息（FoodInfoItem）的接口编码</h2><h3 id="题-1" tabindex="-1"><a class="header-anchor" href="#题-1" aria-hidden="true">#</a> 题（1）</h3><p>（1）编写食品溯源智能合约生产商Producer添加食品接口，必须生产商才能添加可溯源的食品，实现溯源功能；</p><p>这部分主要是初始化一些会在接下来的程序中用到的变量。</p><p>根据前面表格中数据可得应填入：</p><div class="language-solidity line-numbers-mode" data-ext="solidity"><pre class="language-solidity"><code><span class="token keyword">contract</span> <span class="token class-name">FoodInfoItem</span> <span class="token punctuation">{</span>
    <span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> _timestamp<span class="token punctuation">;</span>
    <span class="token builtin">string</span> _traceName<span class="token punctuation">;</span>
    <span class="token builtin">address</span> _traceAddress<span class="token punctuation">;</span>
    <span class="token builtin">uint8</span> _traceQuality<span class="token punctuation">;</span>
    <span class="token builtin">string</span> _name<span class="token punctuation">;</span>
    <span class="token builtin">string</span> _currentTraceName<span class="token punctuation">;</span>
    <span class="token builtin">uint8</span> _quality<span class="token punctuation">;</span>
    <span class="token builtin">uint8</span> _status<span class="token punctuation">;</span>

    <span class="token builtin">address</span> _owner<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="题-2" tabindex="-1"><a class="header-anchor" href="#题-2" aria-hidden="true">#</a> 题（2）</h3><p>（2）编写分销商食品上链信息接口，根据食品溯源智能合约地址获取分销商上链食品的信息；</p><div class="language-solidity line-numbers-mode" data-ext="solidity"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">addTraceInfoByDistributor</span><span class="token punctuation">(</span>①<span class="token punctuation">,</span> <span class="token builtin">uint8</span> quality<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>_status <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">,</span> <span class="token string">&quot;status must be producing&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//②</span>
        _timestamp<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">;</span>
        _traceName<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>traceName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        _currentTraceName <span class="token operator">=</span> traceName<span class="token punctuation">;</span>
        <span class="token comment">//③</span>
        <span class="token comment">//④</span>
        _traceQuality<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>_quality<span class="token punctuation">)</span><span class="token punctuation">;</span>
        _status <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>根据函数名和题目可得，这是一个通过<strong>分销商</strong><code>Distributor</code>渠道向链上添加信息的函数，此时需要的传入的内容应该包括分销商的<strong>地址</strong>和产品的<strong>质量</strong>（其他变量可以直接通过环境传入） 故：</p><div class="language-solidity line-numbers-mode" data-ext="solidity"><pre class="language-solidity"><code><span class="token comment">// 需要传入的变量还有分销商的地址和当前用户的名称，故在函数定义中的①部分中传入</span>
<span class="token keyword">function</span> <span class="token function">addTraceInfoByDistributor</span><span class="token punctuation">(</span><span class="token builtin">address</span> distributor<span class="token punctuation">,</span> <span class="token builtin">string</span> <span class="token keyword">memory</span> traceName<span class="token punctuation">,</span> <span class="token builtin">uint8</span> quality<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>_status <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">,</span> <span class="token string">&quot;status must be producing&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//②的位置需要一个检查，确保只有链的所有者可以上传信息，所以通过msg.sender来确认发送者</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender <span class="token operator">==</span> _owner<span class="token punctuation">,</span> <span class="token string">&quot;Only constant owner can invoke&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        _timestamp<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">;</span>
        _traceName<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>traceName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        _currentTraceName <span class="token operator">=</span> traceName<span class="token punctuation">;</span>

        <span class="token comment">//③处需要传入产品的分销商的信息</span>
        _traceDistributor<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>distributor<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//④处需要传入产品的质量信息</span>
        _quality <span class="token operator">=</span> quality<span class="token punctuation">;</span>

        _traceQuality<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>_quality<span class="token punctuation">)</span><span class="token punctuation">;</span>
        _status <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="题-3" tabindex="-1"><a class="header-anchor" href="#题-3" aria-hidden="true">#</a> 题（3）</h3><p>（3）编写超市进行食品上链信息的接口，根据食品溯源智能合约地址获取超市上链食品信息。</p><div class="language-solidity line-numbers-mode" data-ext="solidity"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">addTraceInfoByRetailer</span><span class="token punctuation">(</span>①<span class="token punctuation">,</span> <span class="token builtin">uint8</span> quality<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>_status <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">,</span> <span class="token string">&quot;status must be distributing&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//②</span>
        _timestamp<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">;</span>
        _traceName<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>traceName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        _currentTraceName <span class="token operator">=</span> traceName<span class="token punctuation">;</span>
        <span class="token comment">//③</span>
        <span class="token comment">//④</span>
        _traceQuality<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>_quality<span class="token punctuation">)</span><span class="token punctuation">;</span>
        _status <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>既然也是要上链，自然是要先传入当前的使用用户和溯源过程中超市的地址，所以还是：</p><div class="language-solidity line-numbers-mode" data-ext="solidity"><pre class="language-solidity"><code><span class="token comment">// ①传入超市的地址和用户名</span>
<span class="token keyword">function</span> <span class="token function">addTraceInfoByRetailer</span><span class="token punctuation">(</span><span class="token builtin">address</span> retailer<span class="token punctuation">,</span> <span class="token builtin">string</span> traceNumber<span class="token punctuation">,</span> <span class="token builtin">uint8</span> quality<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">require</span><span class="token punctuation">(</span>_status <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;status must be distributing&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// ②代码中没有检测所有权的部分，所以这里首先应该验证操作者是否具有合约的所有权</span>
    <span class="token keyword">require</span><span class="token punctuation">(</span>_owner <span class="token operator">==</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> <span class="token string">&quot;only constant owner can invoke&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    _timestamp<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _traceName<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>traceName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _currentTraceName <span class="token operator">=</span> traceName<span class="token punctuation">;</span>

    <span class="token comment">// ③函数中还没有做的事情是将超市的地址推送上链，所以执行一下这步</span>
    _traceAddress<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>retailer<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// ④后面的代码中使用了_quality传入链中，所以这里我们传入一下这个值</span>
    _quality <span class="token operator">=</span> quality<span class="token punctuation">;</span>

    _traceQuality<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>_quality<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _status <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-食品溯源-trace-的接口编码" tabindex="-1"><a class="header-anchor" href="#_2-食品溯源-trace-的接口编码" aria-hidden="true">#</a> 2.食品溯源(Trace)的接口编码</h2><h3 id="题-1-1" tabindex="-1"><a class="header-anchor" href="#题-1-1" aria-hidden="true">#</a> 题（1）</h3><p>（1）编写食品溯源智能合约生产商Producer添加食品接口，必须生产商才能添加可溯源的食品，实现溯源功能；</p><div class="language-solidity line-numbers-mode" data-ext="solidity"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">newFood</span><span class="token punctuation">(</span>①<span class="token punctuation">,</span> <span class="token builtin">string</span> traceName<span class="token punctuation">,</span> <span class="token builtin">uint8</span> quality<span class="token punctuation">)</span>
	<span class="token keyword">public</span> ② <span class="token keyword">returns</span><span class="token punctuation">(</span>③<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">//④</span>
            <span class="token comment">//⑤</span>
            <span class="token comment">//⑥</span>
            <span class="token comment">//⑦</span>
            <span class="token comment">//⑧</span>
        <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>草了，怎么突然糊出来一大块要我填。</p><p>首先自然还是要看题，它要求只有生产商才能添加可溯源的食品，并且这里要求我们添加食品，那么①和②两个空大致就知道怎么去填入了。</p><p>然后，添加新的食品也就需要给这个食品分一个新的地址，所以这个函数返回的值也就应该是生成的新地址。</p><div class="language-solidity line-numbers-mode" data-ext="solidity"><pre class="language-solidity"><code><span class="token comment">// 不得不说solidity这个语法是真的丑，定语全都堆在函数定义里面</span>
<span class="token comment">// ①中自然是填入食品的名称和溯源用的id，而根据题目可以知道②是要求只有生产商可以访问这个函数，而函数返回的值应该是新食品的地址</span>
<span class="token keyword">function</span> <span class="token function">newFood</span><span class="token punctuation">(</span><span class="token builtin">string</span> name<span class="token punctuation">,</span> <span class="token builtin">uint256</span> traceNumber<span class="token punctuation">,</span> <span class="token builtin">string</span> traceName<span class="token punctuation">,</span> <span class="token builtin">uint8</span> quality<span class="token punctuation">)</span> <span class="token keyword">public</span> onlyProducer <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 反正四五六七八都是在一块，只是告诉你要用五行代码罢了（</span>
    <span class="token comment">// 思路上来讲，要做的无非是以下这些：</span>
    <span class="token comment">// 1.验证溯源id</span>
    <span class="token comment">// 2.实例化新的食品对象</span>
    <span class="token comment">// 3.将新的食品对象传入foods</span>
    <span class="token comment">// 4.推送</span>
    <span class="token comment">// 所以大致上就是一条条写</span>
    <span class="token keyword">require</span><span class="token punctuation">(</span>foods<span class="token punctuation">[</span>traceNumber<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token builtin">address</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;traceNumber already exist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    FoodInfoItem food <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FoodInfoItem</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> traceName<span class="token punctuation">,</span> quality<span class="token punctuation">,</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">)</span><span class="token punctuation">;</span>
    foods<span class="token punctuation">[</span>traceNumber<span class="token punctuation">]</span> <span class="token operator">=</span> food<span class="token punctuation">;</span>
    foodList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>traceNumber<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> food<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="题-3-1" tabindex="-1"><a class="header-anchor" href="#题-3-1" aria-hidden="true">#</a> 题（3）</h3><p>（3）编写食品溯源智能合约超市Retailer添加食品接口，必须超市才能添加可溯源的食品，实现溯源功能。</p><div class="language-solidity line-numbers-mode" data-ext="solidity"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">addTraceInfoByRetailer</span><span class="token punctuation">(</span>①<span class="token punctuation">,</span> <span class="token builtin">uint8</span> quality<span class="token punctuation">)</span>
	<span class="token keyword">public</span> ② <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">require</span><span class="token punctuation">(</span>③<span class="token punctuation">,</span> <span class="token string">&quot;traceNumber does not exist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token function">FoodInfoItem</span><span class="token punctuation">(</span>foods<span class="token punctuation">[</span>traceNumber<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>④<span class="token punctuation">,</span> quality<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>因为是实现添加溯源信息功能，传入当前用户的名称和合约超市的地址：</p><div class="language-solidity line-numbers-mode" data-ext="solidity"><pre class="language-solidity"><code><span class="token comment">// ①的位置传入用户名和食品溯源的id,②的位置则onlyRetailer来限制合约的使用权限</span>
<span class="token keyword">function</span> <span class="token function">addTraceInfoByRetailer</span><span class="token punctuation">(</span><span class="token builtin">string</span> traceName<span class="token punctuation">,</span> <span class="token builtin">string</span> traceNumber<span class="token punctuation">,</span> <span class="token builtin">uint8</span> quality<span class="token punctuation">)</span> <span class="token keyword">public</span> onlyRetailer <span class="token keyword">returns</span><span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">//③检测traceNumber是否存在</span>
    <span class="token keyword">require</span><span class="token punctuation">(</span>foods<span class="token punctuation">[</span>traceNumber<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token builtin">address</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;traceNumber does not exist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//④的位置</span>
    <span class="token keyword">return</span> <span class="token function">FoodInfoItem</span><span class="token punctuation">(</span>food<span class="token punctuation">[</span>traceNumber<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addTraceInfoByRetailer</span><span class="token punctuation">(</span>traceName<span class="token punctuation">,</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> quality<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,32),o=[p];function c(i,u){return s(),a("div",null,o)}const r=n(e,[["render",c],["__file","ques1.html.vue"]]);export{r as default};
