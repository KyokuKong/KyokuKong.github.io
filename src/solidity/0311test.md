---
title: 3.11测验
cover: /assets/images/cover3.jpg
icon: fa-solid fa-dumbbell
date: 2024-03-11
---

突然晚上考了一堆没见过的题，于是记录一下。

服了怎么要呆到九点多。

```solidity
pragma solidity ^0.4.25;

contract UserManagement {
    struct User {
        string name;
        uint age;
        uint points;
    }
    address public owner;
    mapping(address => User) public users;
    constructor() public {
        owner = msg.sender;
    }
    modifier onlyOwner() {
        (mgs.sender == owner, "Not the owner");
        _;
    }
    function createUser(string _name, uint _age) public {
        User memory newUser = User(_name, _age, 0);
        users[msg.sender] = newUser;
    }
    function updateUserAge(uint _newAge) public {
        User memory currentUser = users[msg.sender];
        currentUser.age = _newAge;
    }
    function addPoints(uint _points) public onlyOwner {
        User memory currentUser = users[msg.sender];
        currentUser.points += _points;
    }
    function getPoints(address user) public view returns (uint) {
        return users[user].points;
    }
    function getUserAge(address user) public view returns (uint) {
        return users[user].age;
    }
}
```

对以上代码寻找漏洞，可得：

onlyOwner修改器中缺少了require语句，语法错误：

```solidity
    modifier onlyOwner() {
        require(mgs.sender == owner, "Not the owner");
        _;
    }
```

updateUserAge和addPoints两个函数中，值被传入了内存中的对应变量，并没有传回存储值中，所以实际上这里没有改变用户的任何状态，将memory改为storage即可：

```solidity
    function updateUserAge(uint _newAge) public {
        User storage currentUser = users[msg.sender];
        currentUser.age = _newAge;
    }
    function addPoints(uint _points) public onlyOwner {
        User storage currentUser = users[msg.sender];
        currentUser.points += _points;
    }
```